<!DOCTYPE html>
<html>
<body>
<h2>Leggere un file XML contenete un elenco di nomi attraverso l'oggetto XMLHttpRequest() e la responseXML</h2>
<input id="b1" type="button" onclick="LetturaFile();" value="leggi i dati dal file">
<input id="cerca" type="text" placeholder="Inserisci lettera per ricerca cognomi">
<input id="b5" type="button" onclick="CercaCognomi();" value="Cerca Cognomi">
<table id="t1"></table>

<script>
function LetturaFile()
{
    var xmlhttp = new XMLHttpRequest(); // si crea un oggetto di tipo XMLHttpRequest
    xmlhttp.open("GET", "https://francescofollatello.github.io/progetti_js/dati.xml",true); //specifica la richiesta: il metodo GET,  il file da aprire, in modo asincrono (true)
                    
    xmlhttp.send();  // manda la richiesta al server
    xmlhttp.onload = function() // si definisce una funzione che sarà chiamata quando la richiesta è ricevuta (caricata)
    { 
        xmlDoc = xmlhttp.responseXML; // si definisce la risposta di tipo XML perchè è stato aperto un file xml
        txt1 = "<tr><th>Nome</th><th>Cognome</th><th>Anni</th></tr>";

        nomi = xmlDoc.getElementsByTagName("nome"); 
        cognomi= xmlDoc.getElementsByTagName("cognome");
        anni = xmlDoc.getElementsByTagName("anni");

        for (i = 0; i <cognomi.length; i++) // si crea dinamicamente il codice di una tabella HTML contenente i valori dei cognomi  e nomi
        {
            txt1 += "<tr><td>" + nomi[i].childNodes[0].nodeValue + "</td><td>" + cognomi[i].childNodes[0].nodeValue + "</td><td>" + anni[i].childNodes[0].nodeValue + "</td></tr>";
        } 
        document.getElementById("t1").innerHTML = txt1;//la stringa contenente codice HTML viene inserita nella tabella identificata con "t1"	  
    }
}
function CercaCognomi()
{
var xmlhttp = new XMLHttpRequest(); // si crea un oggetto di tipo XMLHttpRequest
xmlhttp.open("GET", "https://francescofollatello.github.io/progetti_js/dati.xml",true); //specifica la richiesta: il metodo GET,  il file da aprire, in modo asincrono (true)
                    
xmlhttp.send();  // manda la richiesta al server 

xmlhttp.onload = function() {
xmlDoc = xmlhttp.responseXML; // si definisce la risposta di tipo XML perchè è stato aperto un file xml

str="<tr><th> Nome </th> <th> Cognome </th> <th>Anni</th>";
var ricerca = document.getElementById("cerca").value.toUpperCase();
cognomi= xmlDoc.getElementsByTagName("cognome");
for (i = 0; i <cognomi.length; i++) 
{
    var cognome = cognomi[i].childNodes[0].nodeValue;
    if(cognome.toUpperCase().startsWith(ricerca))
    {
        nomi = xmlDoc.getElementsByTagName("nome");
        anni = xmlDoc.getElementsByTagName("anni");
        str += "<tr><td>" + nomi[i].childNodes[0].nodeValue + "</td><td>" + cognome + "</td><td>" + anni[i].childNodes[0].nodeValue + "</td></tr>";
    }
}
str = str+"</TABLE>";
document.getElementById("t1").innerHTML = str;
}
}
</script>

</body>
</html>